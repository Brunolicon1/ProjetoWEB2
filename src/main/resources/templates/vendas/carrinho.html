<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragmentos/layout :: layout(~{::head}, ~{::main}, false)}">

<head th:replace="~{fragmentos/head :: common_head('Carrinho de Compras')}">
</head>

<body>

<main th:fragment="main" class="flex-grow container mx-auto py-10 px-4">

    <div class="flex items-center gap-4 mb-8">
        <h1 class="text-3xl font-bold text-gray-100">Carrinho de Compras</h1>
        <span class="bg-emerald-600 text-white text-sm font-bold px-3 py-1 rounded-full"
              th:text="${venda.itens.size()} + ' Itens'">0 Itens</span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <div class="lg:col-span-2 space-y-4">

            <div th:if="${venda.itens.isEmpty()}" class="bg-[#2b2d31] border border-gray-700 p-10 rounded-xl text-center">
                <p class="text-gray-400 text-lg mb-4">O seu carrinho está vazio.</p>
                <a th:href="@{/vendas/form}" class="text-emerald-400 hover:text-emerald-300 underline">
                    Voltar para o catálogo
                </a>
            </div>

            <div th:unless="${venda.itens.isEmpty()}" class="bg-[#2b2d31] border border-gray-700 rounded-xl overflow-hidden shadow-lg">
                <table class="w-full text-left">
                    <thead class="bg-gray-800 text-gray-400 uppercase text-xs font-semibold">
                    <tr>
                        <th class="px-6 py-4">Produto</th>
                        <th class="px-6 py-4 text-center">Qtd</th>
                        <th class="px-6 py-4 text-right">Unitário</th>
                        <th class="px-6 py-4 text-right">Total</th>
                    </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700 text-gray-300">
                    <tr th:each="item : ${venda.itens}" class="hover:bg-gray-700/50 transition-colors">
                        <td class="px-6 py-4">
                            <div class="font-medium text-white" th:text="${item.produto.descricao}">Produto</div>
                            <div class="text-xs text-gray-500" th:text="'Ref: ' + ${item.produto.id}">Ref</div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <span class="bg-gray-900 text-gray-200 py-1 px-3 rounded-md font-mono"
                                  th:text="${item.quantidade}">1</span>
                        </td>
                        <td class="px-6 py-4 text-right"
                            th:text="${#numbers.formatCurrency(item.produto.valor)}">R$ 0,00</td>
                        <td class="px-6 py-4 text-right font-bold text-emerald-400"
                            th:text="${#numbers.formatCurrency(item.total())}">R$ 0,00</td>
                    </tr>
                    </tbody>
                </table>

                <div class="bg-gray-800 px-6 py-4 text-right">
                    <a th:href="@{/vendas/form}" class="text-sm text-emerald-400 hover:text-emerald-300 font-medium">
                        + Adicionar mais produtos
                    </a>
                </div>
            </div>
        </div>

        <div class="lg:col-span-1">
            <div class="bg-[#2b2d31] border border-gray-700 rounded-xl p-6 shadow-xl sticky top-6">
                <h2 class="text-xl font-semibold text-white mb-6 border-b border-gray-700 pb-2">Resumo do Pedido</h2>

                <form th:action="@{/vendas/save}" method="post" class="space-y-6">

                    <input type="hidden" name="id" th:value="${venda.id}" th:if="${venda.id != 0}">

                    <div>
                        <label for="pessoa" class="block text-sm font-medium text-gray-400 mb-1">Cliente</label>
                        <select id="pessoa" name="pessoaId" required
                                class="w-full px-4 py-2 bg-[#1e1f22] border border-gray-600 text-gray-100 rounded-lg">
                            <option value="" disabled th:selected="${venda.pessoa == null}">Selecione o cliente...</option>
                            <option th:each="p : ${pessoas}"
                                    th:value="${p.id}"
                                    th:text="${p.nome}"
                                    th:selected="${venda.pessoa != null and venda.pessoa.id == p.id}">
                            </option>
                        </select>
                    </div>

                    <div>
                        <label for="data" class="block text-sm font-medium text-gray-400 mb-1">Data da Venda</label>
                        <input type="date" id="data" name="data" required
                               th:value="${venda.data}"
                               class="w-full px-4 py-2 bg-[#1e1f22] border border-gray-600 text-gray-100 rounded-lg">
                    </div>

                    <div class="border-t border-gray-700 pt-4 mt-4 space-y-2">
                        <div class="flex justify-between text-gray-400">
                            <span>Subtotal</span>
                            <span th:text="${#numbers.formatCurrency(venda.total())}">R$ 0,00</span>
                        </div>
                        <button type="submit" class="...">Finalizar Venda</button>
                    </div>
                </form>
            </div>
        </div>

    </div>

</main>

</body>
</html>